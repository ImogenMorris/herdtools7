<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>RunTime (herdtools7.Asllib.Env.RunTime)</title><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">herdtools7</a> &#x00BB; <a href="../../index.html">Asllib</a> &#x00BB; <a href="../index.html">Env</a> &#x00BB; RunTime</nav><header class="odoc-preamble"><h1>Module <code><span>Env.RunTime</span></code></h1><p>Internal representation for subprograms.</p></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a><ul><li><a href="#types-and-constructors.">Types and constructors.</a></li><li><a href="#accessors">Accessors</a></li><li><a href="#loop-unrolling">Loop unrolling</a></li><li><a href="#scope-handling">Scope handling</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-C"><a href="#argument-1-C" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-C/index.html">C</a></span><span> : <a href="../module-type-RunTimeConf/index.html">RunTimeConf</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><h3 id="types-and-constructors."><a href="#types-and-constructors." class="anchor"></a>Types and constructors.</h3><div class="odoc-spec"><div class="spec type anchored" id="type-func"><a href="#type-func" class="anchor"></a><code><span><span class="keyword">type</span> func</span><span> = <span>int <span class="xref-unresolved">Stdlib</span>.ref</span> * <span><a href="argument-1-C/index.html#type-primitive">C.primitive</a> <a href="../../AST/index.html#type-func">AST.func</a></span></span></code></div><div class="spec-doc"><p>A function has an index that keeps a unique calling index.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-global"><a href="#type-global" class="anchor"></a><code><span><span class="keyword">type</span> global</span><span> = </span><span>{</span></code><ol><li id="type-global.static" class="def record field anchored"><a href="#type-global.static" class="anchor"></a><code><span>static : <a href="../../StaticEnv/index.html#type-global">StaticEnv.global</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>References the static environment.</p><span class="comment-delim">*)</span></div></li><li id="type-global.storage" class="def record field anchored"><a href="#type-global.storage" class="anchor"></a><code><span>storage : <span><a href="argument-1-C/index.html#type-v">C.v</a> <a href="../../Storage/index.html#type-t">Storage.t</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Binds global variables to their names.</p><span class="comment-delim">*)</span></div></li><li id="type-global.funcs" class="def record field anchored"><a href="#type-global.funcs" class="anchor"></a><code><span>funcs : <span><a href="#type-func">func</a> <a href="../../ASTUtils/IMap/index.html#type-t">ASTUtils.IMap.t</a></span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Declared subprograms, maps called identifier to their code.</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The global part of an environment.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-local"><a href="#type-local" class="anchor"></a><code><span><span class="keyword">type</span> local</span></code></div><div class="spec-doc"><p>The local part of an environment.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-env"><a href="#type-env" class="anchor"></a><code><span><span class="keyword">type</span> env</span><span> = </span><span>{</span></code><ol><li id="type-env.global" class="def record field anchored"><a href="#type-env.global" class="anchor"></a><code><span>global : <a href="#type-global">global</a>;</span></code></li><li id="type-env.local" class="def record field anchored"><a href="#type-env.local" class="anchor"></a><code><span>local : <a href="#type-local">local</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The environment type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty_local"><a href="#val-empty_local" class="anchor"></a><code><span><span class="keyword">val</span> empty_local : <a href="#type-local">local</a></span></code></div><div class="spec-doc"><p>An empty local environment.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_static"><a href="#val-to_static" class="anchor"></a><code><span><span class="keyword">val</span> to_static : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../StaticEnv/index.html#type-env">StaticEnv.env</a></span></code></div><div class="spec-doc"><p>Builds a static environment, with an empty local part.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty_scoped"><a href="#val-empty_scoped" class="anchor"></a><code><span><span class="keyword">val</span> empty_scoped : <span><a href="../../AST/index.html#type-scope">AST.scope</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-local">local</a></span></code></div><div class="spec-doc"><p><code>empty_scoped scope</code> is an empty local environment in the scope <code>scope</code>.</p></div></div><h3 id="accessors"><a href="#accessors" class="anchor"></a>Accessors</h3><div class="odoc-spec"><div class="spec type anchored" id="type-env_result"><a href="#type-env_result" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a env_result</span></span><span> = </span></code><ol><li id="type-env_result.Local" class="def variant constructor anchored"><a href="#type-env_result.Local" class="anchor"></a><code><span>| </span><span><span class="constructor">Local</span> <span class="keyword">of</span> <span class="type-var">'a</span></span></code></li><li id="type-env_result.Global" class="def variant constructor anchored"><a href="#type-env_result.Global" class="anchor"></a><code><span>| </span><span><span class="constructor">Global</span> <span class="keyword">of</span> <span class="type-var">'a</span></span></code></li><li id="type-env_result.NotFound" class="def variant constructor anchored"><a href="#type-env_result.NotFound" class="anchor"></a><code><span>| </span><span><span class="constructor">NotFound</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Indicates if the value returned was bound in the global or local namespace.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find"><a href="#val-find" class="anchor"></a><code><span><span class="keyword">val</span> find : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-C/index.html#type-v">C.v</a> <a href="#type-env_result">env_result</a></span></span></code></div><div class="spec-doc"><p>Fetches an identifier from the environment.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>mem x env</code> is true iff <code>x</code> is bound in <code>env</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-declare_local"><a href="#val-declare_local" class="anchor"></a><code><span><span class="keyword">val</span> declare_local : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-C/index.html#type-v">C.v</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p><code>declare_local x v env</code> is <code>env</code> where <code>x</code> is now bound to <code>v</code>. This binding will be discarded by the call to <code>pop_scope</code> corresponding to the last call to <code>push_scope</code> before this declaration.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assign_local"><a href="#val-assign_local" class="anchor"></a><code><span><span class="keyword">val</span> assign_local : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-C/index.html#type-v">C.v</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p><code>assign_local x v env</code> is <code>env</code> where <code>x</code> is now bound to <code>v</code>. It is assumed to be already bound in <code>env</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-declare_global"><a href="#val-declare_global" class="anchor"></a><code><span><span class="keyword">val</span> declare_global : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-C/index.html#type-v">C.v</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p><code>declare_global x v env</code> is <code>env</code> where <code>x</code> is now bound to <code>v</code>. It is supposed that <code>x</code> is not bound in <code>env</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assign_global"><a href="#val-assign_global" class="anchor"></a><code><span><span class="keyword">val</span> assign_global : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-C/index.html#type-v">C.v</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p><code>assign_global x v env</code> is <code>env</code> where <code>x</code> is now bound to <code>v</code>. It is assumed to be already bound in <code>env</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove_local"><a href="#val-remove_local" class="anchor"></a><code><span><span class="keyword">val</span> remove_local : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p><code>remove_local x env</code> is <code>env</code> where <code>x</code> is not bound.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assign"><a href="#val-assign" class="anchor"></a><code><span><span class="keyword">val</span> assign : <span><a href="../../AST/index.html#type-identifier">AST.identifier</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="argument-1-C/index.html#type-v">C.v</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <a href="#type-env_result">env_result</a></span></span></code></div><div class="spec-doc"><p><code>assign x v env</code> assigns <code>x</code> to <code>v</code> in <code>env</code>, and returns if <code>x</code> was declared as a local or global identifier.</p></div></div><h3 id="loop-unrolling"><a href="#loop-unrolling" class="anchor"></a>Loop unrolling</h3><div class="odoc-spec"><div class="spec value anchored" id="val-tick_push"><a href="#val-tick_push" class="anchor"></a><code><span><span class="keyword">val</span> tick_push : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p>Push a new unrolling counter on the stack. The associated loop will be unrolled <code>C.unroll</code> times.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tick_push_bis"><a href="#val-tick_push_bis" class="anchor"></a><code><span><span class="keyword">val</span> tick_push_bis : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p>Push a new unrolling counter on the stack. The associated loop will be unrolled <code>C.unroll - 1</code> times.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tick_pop"><a href="#val-tick_pop" class="anchor"></a><code><span><span class="keyword">val</span> tick_pop : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p>Discards the last unrolling counter of the stack.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tick_decr"><a href="#val-tick_decr" class="anchor"></a><code><span><span class="keyword">val</span> tick_decr : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> bool * <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p><code>tick_decr env</code> is <code>(stop, env')</code> where</p><ul><li>if the last counter is lower or equal to 1, <code>stop</code> is true and the last counter is discarded.</li><li>if the last counter is bigger or equal to 2, <code>stop</code> is false and the counter is decremented of 1.</li></ul></div></div><h3 id="scope-handling"><a href="#scope-handling" class="anchor"></a>Scope handling</h3><div class="odoc-spec"><div class="spec value anchored" id="val-get_scope"><a href="#val-get_scope" class="anchor"></a><code><span><span class="keyword">val</span> get_scope : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../AST/index.html#type-scope">AST.scope</a></span></code></div><div class="spec-doc"><p>Returns the local scope of that environment.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-same_scope"><a href="#val-same_scope" class="anchor"></a><code><span><span class="keyword">val</span> same_scope : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>same_scope env1 env2</code> is <code>true</code> iff <code>env1</code>'s scope and <code>env2</code>'scope are equal.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-push_scope"><a href="#val-push_scope" class="anchor"></a><code><span><span class="keyword">val</span> push_scope : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p>Push a new scope on the declaration stack. Variables declared here will be stored until the corresponding <code>pop_scope</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pop_scope"><a href="#val-pop_scope" class="anchor"></a><code><span><span class="keyword">val</span> pop_scope : <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-env">env</a></span></code></div><div class="spec-doc"><p><code>pop_scope old new</code> restores the variable bindings of <code>old</code>, with the updated values of <code>new</code>.</p></div></div></div></body></html>